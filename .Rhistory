{
drib <- drive_upload(media=file.docx,path="Thesis",name=file.title,type="document")
cat("\nNew File Created (sharing may be not be active)")
} else {
drib <- drive_update(file=file.title,media=file.docx)
cat("\nUpdated file on Google Docs")
}
cat("\n\nShareable Link for ",file.title,":\n\t",
"https://docs.google.com/document/d/",drib$id,"/edit?usp=sharing",sep="")
setwd("C:/Users/mbrxsmbc/Documents/Thesis/index/")
if(out) return(drib)
}
knit_all_Google <- function()
{
ff <- list.files()
ff <- ff[grep("^[0-9]",ff)]
ff <- ff[-grep("^(00|99)",ff)]
docs <- map_dfr(ff,knit_to_Google,out=T)
return(docs)
}
knit_to_Google(4)
knit_to_Google(4)
knit_to_Google(4)
knit_to_Google(4)
knit_to_Google(4)
knit_to_Google(4)
knit_to_Google(4)
knit_to_Google(4)
knit_to_Google(4)
knit_chapter(1)
setwd("C:/Users/mbrxsmbc/Documents/Thesis/index/")
latex.commands <- readLines("latex_commands.txt")
latex.commands
grep("^\\",latex.commands)
grep("^\",latex.commands)
""
"
grep("^\\\",latex.commands)
"
)
grep("^\\\\",latex.commands)
latex.commands[ latex.slash] <- paste0(" - ",latex.commands[ latex.slash])
latex.commands[-latex.slash] <- paste0("   ",latex.commands[-latex.slash])
latex.commands <- readLines("latex_commands.txt")
latex.slash <- grep("^\\\\",latex.commands)
latex.commands[ latex.slash] <- paste0(" - ",latex.commands[ latex.slash])
latex.commands[-latex.slash] <- paste0("   ",latex.commands[-latex.slash])
latex.commands
write_chapter_rmd <- function(.file,output="pdf")
{
setwd("C:/Users/mbrxsmbc/Documents/Thesis/index/")
if(is.numeric(.file))
{
if(.file <10) .file <- paste0("0",.file) else .file <- paste0(.file)
ff <- list.files()
.file <- ff[grep(.file,ff)]
}
rmd <- readLines(.file)
latex.commands <- readLines("latex_commands.txt")
latex.slash <- grep("^\\\\",latex.commands)
latex.commands[ latex.slash] <- paste0(" - ",latex.commands[ latex.slash])
latex.commands[-latex.slash] <- paste0("   ",latex.commands[-latex.slash])
title <- rmd[grep("^# ",rmd[1:3])]
title <- substring(title,1,regexpr("{",title,fixed=T)[[1]]-1)
title <- trimws(gsub("#","",title,fixed=T))
title <- paste0("title: ",title)
figure.lines <- grep("include_graphics(\"",rmd,fixed=T)
if(length(figure.lines) > 0)
{
rmd[figure.lines] <- gsub("include_graphics(\"",
"include_graphics(\"../",
rmd[figure.lines],
fixed=T)
}
if(output == "pdf")
{
output.header <- c("output:",
"  bookdown::pdf_document2")
} else if(output=="word")
{
output.header <- c("output:",
"  bookdown::word_document2:",
"    reference_docx: Ref.docx")
} else
{
output.header <- c("output:",
paste0("  bookdown::",output))
}
header <- c(
"---",
title,
"bibliography: ../bib/thesis.bib",
"csl: ../csl/ieee.csl",
"number_sections: true",
output.header,
"header-includes:",
"---",
"```{r setup, include=F}",
"source(\"../setup.R\")",
"```",
latex.commands,
"<style>",
"caption {",
"  display: table-caption;",
"  text-align: center;",
"}",
"</style>"
)
rmd <- rmd[-grep("^# ",rmd[1:3])]
rmd <- gsub("^#","",rmd)
rmd <- c(header,rmd,"","# References","")
writeLines(rmd,paste0("Chapters/",.file))
}
knit_chapter(1)
.file <- 1
setwd("C:/Users/mbrxsmbc/Documents/Thesis/index/")
if(is.numeric(.file))
{
if(.file <10) .file <- paste0("0",.file) else .file <- paste0(.file)
ff <- list.files()
.file <- ff[grep(.file,ff)]
}
.file
rmd <- readLines(.file)
latex.commands <- readLines("latex_commands.txt")
latex.slash <- grep("^\\\\",latex.commands)
latex.commands[ latex.slash] <- paste0(" - ",latex.commands[ latex.slash])
latex.commands[-latex.slash] <- paste0("   ",latex.commands[-latex.slash])
latex.commands
title <- rmd[grep("^# ",rmd[1:3])]
title <- substring(title,1,regexpr("{",title,fixed=T)[[1]]-1)
title <- trimws(gsub("#","",title,fixed=T))
title <- paste0("title: ",title)
figure.lines <- grep("include_graphics(\"",rmd,fixed=T)
if(length(figure.lines) > 0)
{
rmd[figure.lines] <- gsub("include_graphics(\"",
"include_graphics(\"../",
rmd[figure.lines],
fixed=T)
}
(output == "pdf")
output.header <- c("output:",
"  bookdown::pdf_document2")
header <- c(
"---",
title,
"bibliography: ../bib/thesis.bib",
"csl: ../csl/ieee.csl",
"number_sections: true",
output.header,
"header-includes:",
"---",
"```{r setup, include=F}",
"source(\"../setup.R\")",
"```",
latex.commands,
"<style>",
"caption {",
"  display: table-caption;",
"  text-align: center;",
"}",
"</style>"
)
header
write_chapter_rmd <- function(.file,output="pdf")
{
setwd("C:/Users/mbrxsmbc/Documents/Thesis/index/")
if(is.numeric(.file))
{
if(.file <10) .file <- paste0("0",.file) else .file <- paste0(.file)
ff <- list.files()
.file <- ff[grep(.file,ff)]
}
rmd <- readLines(.file)
latex.commands <- readLines("latex_commands.txt")
latex.slash <- grep("^\\\\",latex.commands)
latex.commands[ latex.slash] <- paste0(" - ",latex.commands[ latex.slash])
latex.commands[-latex.slash] <- paste0("   ",latex.commands[-latex.slash])
title <- rmd[grep("^# ",rmd[1:3])]
title <- substring(title,1,regexpr("{",title,fixed=T)[[1]]-1)
title <- trimws(gsub("#","",title,fixed=T))
title <- paste0("title: ",title)
figure.lines <- grep("include_graphics(\"",rmd,fixed=T)
if(length(figure.lines) > 0)
{
rmd[figure.lines] <- gsub("include_graphics(\"",
"include_graphics(\"../",
rmd[figure.lines],
fixed=T)
}
if(output == "pdf")
{
output.header <- c("output:",
"  bookdown::pdf_document2")
} else if(output=="word")
{
output.header <- c("output:",
"  bookdown::word_document2:",
"    reference_docx: Ref.docx")
} else
{
output.header <- c("output:",
paste0("  bookdown::",output))
}
header <- c(
"---",
title,
"bibliography: ../bib/thesis.bib",
"csl: ../csl/ieee.csl",
"number_sections: true",
output.header,
"header-includes:",
latex.commands,
"---",
"```{r setup, include=F}",
"source(\"../setup.R\")",
"```",
"<style>",
"caption {",
"  display: table-caption;",
"  text-align: center;",
"}",
"</style>"
)
rmd <- rmd[-grep("^# ",rmd[1:3])]
rmd <- gsub("^#","",rmd)
rmd <- c(header,rmd,"","# References","")
writeLines(rmd,paste0("Chapters/",.file))
}
knit_chapter <- function(.file,output="pdf")
{
setwd("C:/Users/mbrxsmbc/Documents/Thesis/index/")
if(is.numeric(.file))
{
if(.file <10) .file <- paste0("0",.file) else .file <- paste0(.file)
ff <- list.files()
.file <- ff[grep(.file,ff)]
}
write_chapter_rmd(.file,output)
setwd("C:/Users/mbrxsmbc/Documents/Thesis/index/Chapters")
rmarkdown::render(.file)
setwd("C:/Users/mbrxsmbc/Documents/Thesis/index/")
}
knit_chapter(1)
knit_chapter(1)
knit_chapter(1)
knit_chapter(1)
?LR
xx
cc
LR <- function(n) paste0("[**Cite LR:",x,"**]")
cc <- function(x) paste0("[**Cite: ",x,"**]")
cc("One")
xx("One")
cc <- function(x) xx(paste0("Cite: ",x))
cc("One")
LR <- function(x) cc(paste0("LR - ",x))
LR(1)
xx <- function(x = "xxxx") paste0("[**",x,"**]")
cc <- function(x) xx(paste0("Cite: ",x))
LR <- function(x) cc(paste0("LR - ",x))
bdown=function(url, file){
library('RCurl')
f = CFILE(file, mode="wb")
a = curlPerform(url = url, writedata = f@ref, noprogress=FALSE)
close(f)
return(a)
}
getwd()
bdown("ftp://80.192.34.53/Films/6%20Recently%20Added%20Films/Rocketman.2019.1080p.BluRay.x264.DTS-HD.MA.7.1-FGT/Rocketman.2019.1080p.BluRay.x264.DTS-HD.MA.7.1-FGT.mkv","C:/Users/mbrxsmbc/Documents/Films/Rocketman.mkv")
curlPerform()
curlPerform
missing
missing(1)
?missing
close(f)
curlPerform
bdown
bdown("ftp://michael:myko101ab@80.192.34.53/Films/6%20Recently%20Added%20Films/Rocketman.2019.1080p.BluRay.x264.DTS-HD.MA.7.1-FGT/Rocketman.2019.1080p.BluRay.x264.DTS-HD.MA.7.1-FGT.mkv","C:/Users/mbrxsmbc/Documents/Films/Rocketman.mkv")
bdown("ftp://michael:myko101ab@80.192.34.53:21/Films/6%20Recently%20Added%20Films/Rocketman.2019.1080p.BluRay.x264.DTS-HD.MA.7.1-FGT/Rocketman.2019.1080p.BluRay.x264.DTS-HD.MA.7.1-FGT.mkv","C:/Users/mbrxsmbc/Documents/Films/Rocketman.mkv")
knit_to_Google(4)
knit_to_Google(4)
tibble(id = 1:3,Age=c("20","66","40"),Gender=c("Female","Female","Male"),
`Smoking Status`=c("Non-Smoker","Non-Smoker","Smoker"),
BP=c("144/101","140/80","160/90"),
Albumin=c("39","40","40"),`Correct Calcium`=c("2.3","2.6","3.0"),
Haemoglobin=c("150"," 14","100"), Phosphate=c("0.68","0.86","2.00"),
eGFR=c("42","51","10"),
`eGFR Previous`=c("50 (one week ago)","70 (one week ago)","30 (one year ago)"),
uPCR=c("0.30","0.01","0.20"),
`uPCR Previous`=c("0.80 (one month ago)","0.06 (one week ago)","1.20 (one year ago)"),
`Primary Diagnosis`=c("Glomerulonephritis","Diabetes","Tubular Necrosis"),
Comorbities=c("Chronic Obstructive Pulmonary Disease\nLiver Disease\nSolid Tumour",
"Diabetes\nChronic Obstructive Pulmonary Disease\nHypertension",""))
source("setup.R")
tibble(id = 1:3,Age=c("20","66","40"),Gender=c("Female","Female","Male"),
`Smoking Status`=c("Non-Smoker","Non-Smoker","Smoker"),
BP=c("144/101","140/80","160/90"),
Albumin=c("39","40","40"),`Correct Calcium`=c("2.3","2.6","3.0"),
Haemoglobin=c("150"," 14","100"), Phosphate=c("0.68","0.86","2.00"),
eGFR=c("42","51","10"),
`eGFR Previous`=c("50 (one week ago)","70 (one week ago)","30 (one year ago)"),
uPCR=c("0.30","0.01","0.20"),
`uPCR Previous`=c("0.80 (one month ago)","0.06 (one week ago)","1.20 (one year ago)"),
`Primary Diagnosis`=c("Glomerulonephritis","Diabetes","Tubular Necrosis"),
Comorbities=c("Chronic Obstructive Pulmonary Disease\nLiver Disease\nSolid Tumour",
"Diabetes\nChronic Obstructive Pulmonary Disease\nHypertension",""))
tibble(id = 1:3,Age=c("20","40","66"),Gender=c("Female","Male","Female"),
`Smoking Status`=c("Non-Smoker","Smoker","Non-Smoker"),
BP=c("144/101","160/90","140/80"),
Albumin=c("39","40","40"),`Correct Calcium`=c("2.3","3.0","2.6"),
Haemoglobin=c("150","100"," 14"), Phosphate=c("0.68","2.00","0.86"),
eGFR=c("42","10","51"),
`eGFR Previous`=c("50 (one week ago)","30 (one year ago)","70 (one week ago)"),
uPCR=c("0.30","0.20","0.01"),
`uPCR Previous`=c("0.80 (one month ago)","1.20 (one year ago)","0.06 (one week ago)"),
`Primary Diagnosis`=c("Glomerulonephritis","Tubular Necrosis","Diabetes"),
Comorbities=c("Chronic Obstructive Pulmonary Disease\nLiver Disease\nSolid Tumour","",
"Diabetes\nChronic Obstructive Pulmonary Disease\nHypertension"))
thesis_pdf
thesisdown::thesis_pdf
old <- tibble(id = 1:3,Age=c("20","66","40"),Gender=c("Female","Female","Male"),
`Smoking Status`=c("Non-Smoker","Non-Smoker","Smoker"),
BP=c("144/101","140/80","160/90"),
Albumin=c("39","40","40"),`Correct Calcium`=c("2.3","2.6","3.0"),
Haemoglobin=c("150"," 14","100"), Phosphate=c("0.68","0.86","2.00"),
eGFR=c("42","51","10"),
`eGFR Previous`=c("50 (one week ago)","70 (one week ago)","30 (one year ago)"),
uPCR=c("0.30","0.01","0.20"),
`uPCR Previous`=c("0.80 (one month ago)","0.06 (one week ago)","1.20 (one year ago)"),
`Primary Diagnosis`=c("Glomerulonephritis","Diabetes","Tubular Necrosis"),
Comorbities=c("Chronic Obstructive Pulmonary Disease\nLiver Disease\nSolid Tumour",
"Diabetes\nChronic Obstructive Pulmonary Disease\nHypertension",""))%>%
mutate(id = recode(id,`1`=1,`2`=3,`3`=2))
pkgs <- c("devtools","thesisdown","tidyverse","rlang","flextable",
"googledrive")
purrr::walk(pkgs,library,character.only=T)
xx <- function(x = "xxxx") paste0("[**",x,"**]")
cc <- function(x="Something") xx(paste0("Cite: ",x))
LR <- function(...) cc(paste0("LR - ",paste0(unlist(list(...)),collapse=", ")))
logit <- function(p) log(p/(1-p))
logit1 <- function(o) exp(o)/(exp(o)+1)
.wd <- "C:/Users/mbrxsmbc/Documents/Thesis/index/"
add_flextable_caption <- function(ref,caption)
{
cat("<caption>(\\#tab:",ref,") ",caption,"</caption>",sep="")
}
stardard_format_table <- function(x,numeric.cols=NULL,widths=NULL)
{
x.new <- x %>%
theme_zebra(odd_header="cornflowerblue") %>%
color(part="header",color="white") %>%
fontsize(size=8) %>%
font(part="all",font="Garamond") %>%
padding(padding=0) %>%
align(align="left") %>%
border(border=officer::fp_border(color="black",width=0.5),part="all") %>%
height(height=0.5/2.54)
if(is.null(widths))
{
x.new <- autofit(x.new)
} else
{
x.new <- width(x.new,width=widths/2.54)
}
if(!is.null(numeric.cols))
{
x.new <- x.new %>%
fontsize(j=numeric.cols,size=7) %>%
font(j=numeric.cols,font="courier new") %>%
align(j=numeric.cols,align="right")
}
return(x.new)
}
collapse_footer <- function(x,sep="; ",footer.height=NULL)
{
old.content <- x$footer$content$content$data
new.content <- list()
sep.content <- old.content[1,1][[1]][1,]
sep.content$txt <- sep
sep.content$vertical.align <- NA
for(i in 1:(nrow(old.content)-1))
{
old.content[i,1][[1]] <- rbind(old.content[i,1][[1]],sep.content)
}
new.content[[1]] <- do.call(rbind,old.content[,1])
new.content[[1]]$seq_index <- 1:nrow(new.content[[1]])
for(i in (2:ncol(old.content))) new.content[[i]] <- old.content[1,i][[1]]
dim(new.content) <- c(1,ncol(old.content))
colnames(new.content) <- colnames(old.content)
x$footer$content$content$data <- new.content
x <- merge_at(x,part="footer")
if(is.null(footer.height)) footer.height = tail(dim(x)$heights,1)
x <- height(x,height=0,part="footer")
x <- height(x,i=1,height=footer.height,part="footer")
x
}
Dev_Valid_Paper_Var_Names <- function(.tbl,.variable)
{
.tbl %>%
mutate(!!enquo(.variable) := case_when(
!!enquo(.variable) == "eGFR.Rate" ~ "eGFR Rate",
!!enquo(.variable) == "log.eGFR.Rate" ~ "log(eGFR Rate",
!!enquo(.variable) == "uPCR.Rate" ~ "uPCR Rate",
!!enquo(.variable) == "log.uPCR.Rate" ~ "log(uPCR Rate",
!!enquo(.variable) == "Calcium" ~ "Corrected Calcium",
T ~ !!enquo(.variable)))
}
as_equation <- function(x,i=NULL,j=NULL,nickname)
{
require(flextable)
require(png)
fnum <- 0
ff <- list.files("codecogs")
ff <- ff[grep(paste0("^",nickname),ff)]
if(length(ff) > 0 )
file.remove(paste0("codecogs/",ff))
i <- flextable:::get_rows_id(x[["body"]], i)
j <- flextable:::get_columns_id(x[["body"]], j)
for(i0 in i) for(j0 in j)
{
fnum <- fnum + 1
eqn <- x$body$dataset[i0,j0]
eqn <- gsub("\\","%5C",eqn,fixed=T)
eqn <- gsub(" ","",eqn,fixed=T)
webaddress <- paste0("https://latex.codecogs.com/png.latex?",eqn)
dir <- paste0("codecogs/",nickname," - ",fnum,".png")
download.file(webaddress,dir,mode="wb",quiet=T)
img <- readPNG(dir)
cell.h <- dim(x)$heights[i0]
cell.w <- dim(x)$widths[j0]
cell.ar <- cell.w/cell.h
h <- dim(img)[1]
w <- dim(img)[2]
ar <- w/h
if(cell.ar < ar)
{
res.h <- cell.h
res.w <- cell.h*ar
} else{
res.w <- cell.w
res.h <- cell.w/ar
}
x <- compose(x,i0,j0,part="body",
value=as_paragraph(as_image(src=dir,height=res.h,width=res.w)))
}
return(x)
}
old <- tibble(id = 1:3,Age=c("20","66","40"),Gender=c("Female","Female","Male"),
`Smoking Status`=c("Non-Smoker","Non-Smoker","Smoker"),
BP=c("144/101","140/80","160/90"),
Albumin=c("39","40","40"),`Correct Calcium`=c("2.3","2.6","3.0"),
Haemoglobin=c("150"," 14","100"), Phosphate=c("0.68","0.86","2.00"),
eGFR=c("42","51","10"),
`eGFR Previous`=c("50 (one week ago)","70 (one week ago)","30 (one year ago)"),
uPCR=c("0.30","0.01","0.20"),
`uPCR Previous`=c("0.80 (one month ago)","0.06 (one week ago)","1.20 (one year ago)"),
`Primary Diagnosis`=c("Glomerulonephritis","Diabetes","Tubular Necrosis"),
Comorbities=c("Chronic Obstructive Pulmonary Disease\nLiver Disease\nSolid Tumour",
"Diabetes\nChronic Obstructive Pulmonary Disease\nHypertension",""))%>%
mutate(id = recode(id,`1`=1,`2`=3,`3`=2))
new <- tibble(id = 1:3,Age=c("20","40","66"),Gender=c("Female","Male","Female"),
`Smoking Status`=c("Non-Smoker","Smoker","Non-Smoker"),
BP=c("144/101","160/90","140/80"),
Albumin=c("39","40","40"),`Correct Calcium`=c("2.3","3.0","2.6"),
Haemoglobin=c("150","100"," 14"), Phosphate=c("0.68","2.00","0.86"),
eGFR=c("42","10","51"),
`eGFR Previous`=c("50 (one week ago)","30 (one year ago)","70 (one week ago)"),
uPCR=c("0.30","0.20","0.01"),
`uPCR Previous`=c("0.80 (one month ago)","1.20 (one year ago)","0.06 (one week ago)"),
`Primary Diagnosis`=c("Glomerulonephritis","Tubular Necrosis","Diabetes"),
Comorbities=c("Chronic Obstructive Pulmonary Disease\nLiver Disease\nSolid Tumour","",
"Diabetes\nChronic Obstructive Pulmonary Disease\nHypertension"))
old
new
old %<>% arrange(id)
library(magrittr)
old %<>% arrange(id)
new == old
tibble(id = 1:3,Age=c("20","40","66"),Gender=c("Female","Male","Female"),
`Smoking Status`=c("Non-Smoker","Smoker","Non-Smoker"),
BP=c("144/101","160/90","140/80"),
Albumin=c("39","40","40"),`Correct Calcium`=c("2.3","3.0","2.6"),
Haemoglobin=c("150","100"," 14"), Phosphate=c("0.68","2.00","0.86"),
eGFR=c("42","10","51"),
`eGFR Previous`=c("50 (one week ago)","30 (one year ago)","70 (one week ago)"),
uPCR=c("0.30","0.20","0.01"),
`uPCR Previous`=c("0.80 (one month ago)","1.20 (one year ago)","0.06 (one week ago)"),
`Primary Diagnosis`=c("Glomerulonephritis","Tubular Necrosis","Diabetes"),
Comorbities=c("Chronic Obstructive Pulmonary Disease\nLiver Disease\nSolid Tumour","",
"Diabetes\nChronic Obstructive Pulmonary Disease\nHypertension")) %>%
pivot_longer(-id,names_to="Vars",values_to="Vals") %>%
pivot_wider(names_from=id,values_from=Vals,names_prefix="Patient ")
library(gt)
tibble(id = 1:3,Age=c("20","40","66"),Gender=c("Female","Male","Female"),
`Smoking Status`=c("Non-Smoker","Smoker","Non-Smoker"),
BP=c("144/101","160/90","140/80"),
Albumin=c("39","40","40"),`Correct Calcium`=c("2.3","3.0","2.6"),
Haemoglobin=c("150","100"," 14"), Phosphate=c("0.68","2.00","0.86"),
eGFR=c("42","10","51"),
`eGFR Previous`=c("50 (one week ago)","30 (one year ago)","70 (one week ago)"),
uPCR=c("0.30","0.20","0.01"),
`uPCR Previous`=c("0.80 (one month ago)","1.20 (one year ago)","0.06 (one week ago)"),
`Primary Diagnosis`=c("Glomerulonephritis","Tubular Necrosis","Diabetes"),
Comorbities=c("Chronic Obstructive Pulmonary Disease\nLiver Disease\nSolid Tumour","",
"Diabetes\nChronic Obstructive Pulmonary Disease\nHypertension")) %>%
pivot_longer(-id,names_to="Vars",values_to="Vals") %>%
pivot_wider(names_from=id,values_from=Vals,names_prefix="Patient ") %>%
gt
knitr::include_graphics("figure/Dev_Paper_State_Diagrams.png")
?yaml::yaml.load
